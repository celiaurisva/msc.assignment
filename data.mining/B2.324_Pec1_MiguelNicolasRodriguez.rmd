---
title: "B2.324_Pec1_MiguelNicolasRodriguez"
author: "Miguel Nicolas Rodriguez Martinez"
date: "16 de abril de 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```

## PEC1 Mineria de datos

En esta practica trabajaremos con los datos de opendata de barcelona y haremos un analisis descriptivo sobre el.
Primero, cargamos los datos.

```{r carga de datos}
accidentes = read.csv("Accidentes2017.csv", header = TRUE)
```

Veamos como es nuestro dataframe, con la funcion dim vemos las dimensiones de nuestro dataframe.
COn la funcion str() veremos que tipo de datos tiene nuestro dataframe y el nombre de las columnas.

```{r mostramos descripcion}
dim(accidentes)
str(accidentes)
```

A continuacion cambiaremos los nombres de las columnas de nuestro dataframe.

```{r cambio columnas}
colnames(accidentes) <- c('Exp','DistC','DistN','BarC','BarN','CalleC','CalleN','PC','DiaSN','DiaSn','DiaTipo','A単o','Mesn','MesN','Dia','Turno','Hora','Causa','Veh','Sexo','Edad','PersT','Sit','Vict','X','Y','Long','Lat')

str(accidentes)

```

  * Exp: La columna de numero de expediente es un identificador unico del accidente.
  * Codigo de distrito: es una variable factor que identifica el distrito, a pesar de que identifica como numero es factor.
  * Nombre del distrito: indica el nombre del distrito, es variable factor.,
  * Codigo del barrio: identificador unico del barrio, al igual que codigo de distrito se identifica como int pero


------------------------TODOOOOOOOOOOOOOOOOOOO ------------------------------- EXPLICAAAAAAAAAAAAR --------------------

Ahora para entender con que dimnensiones unicas contamos, vamos a ver cuantos accidentes unicos tenemos, para eso usaremos el expediente como codigo y contaremos los unicos que hay. Con la funcion sapply, contaremos el tama単o de la lista unica que nos queda al sacar solo los distintos en length. Seleccionaremos solo la columna expediente ya que es la que nos identifica un accidente, tambien lo tendremos que pasar a un dataframe.
El numero de personas haremos lo mismo pero sin la funcion unique ya que asumimos que cada linea de nuestro dataset es una persona.


```{r cantidades}
numero_de_accidentes <- sapply(as.data.frame(accidentes$Exp), function(x) length(unique(x)))
numero_de_personas <- sapply(as.data.frame(accidentes$Exp), function(x) length(x))

numero_de_accidentes
numero_de_personas
```

Para mostrar la distribucion de el % de hombres y mujeres dentro de nuestro dataset usaremos un piechart. Primero extraeremos los diferentes sexos y su numero de valores, es decir los que se cuentan, usaremos la funcion aggregate que nos devolvera 2 resultados, los valores diferentes que hay y el numero de veces que se han visto. Despues sacaremos la distribucion de porcentaje en la que usaremos la funcion round para que nos redondee el resultado y quede mejor para la vista despues. Despues sacamos los label que usaremos y le a単adimos el porcentaje, para por ultimo, mostrarlo.

```{r pie chart} 
distribucion_del_sexo <- aggregate(data.frame(count = accidentes$Sexo), list(value = accidentes$Sexo), length)
porcentaje_de_sexos <- round(distribucion_del_sexo$count/sum(distribucion_del_sexo$count)*100)

labels <- distribucion_del_sexo$value
labels <- paste(labels,porcentaje_de_sexos, "%")

pie(porcentaje_de_sexos,labels = labels, col=topo.colors(length(distribucion_del_sexo$value)),
  	main="Pie Chart de distribucion de sexos")
```


Para este caso usaremos la libraria ggplot para asi ver mas tipos de graficos. Como vemos la distribucion es mas o menos igual, aunq vemos que el rango interquartil es algo mas peque単o que el de las mujeres y los desconocidos

```{r boxplot} 
ggplot(accidentes, aes(x=as.factor(Sexo), y=as.numeric(Edad))) + 
    geom_boxplot(fill="slateblue", alpha=0.2) + 
    xlab("sexo")
```


El dia de la semana ya lo tenemos como una variable categorica como hemos podido ver usando la str(), pero en caso de que no estuviera asi lo convertiriamos de una manera.


```{r transformacion dia} 
accidentes$DiaSn <- as.factor(accidentes$DiaSn)
str(accidentes$DiaSn)
```

Listemos los datos de esta variable para ver que es lo que tenemos, no necesitamos mostrar todo, por lo tanto usaremos la funcion head() para que nosmuestre solo una muestra.

```{r transformacion dia} 
head(accidentes$DiaSn)
```


Para entender mejor los dias de la semana y que sea independiente de cualquier idioma cambiaremos los niveles a el siguiente vector. Es importante que el orden del vector sea igual al orden de los niveles, como podemos ver en el apartado anterior, los niveles que tenemos son estos en ese orden:
Levels: Dc Dg Dj Dl Dm Ds Dv


```{r transformacion dia} 
levels(accidentes$DiaSn) <- c("D3","D7","D4","D1","D2","D6","D5")
```


Ahora mostraremos el numero de accidentes por dia ordenado de mayor a menor. Le pasamos la funcion order al dataframe para que nos ordene los balores por dia en descendiente.

```{r transformacion dia} 
numero_de_accidentes_por_dia <- aggregate(data=accidentes, Exp ~ DiaSn, function(x) sort(length(unique(x))) )
numero_de_accidentes_por_dia <- numero_de_accidentes_por_dia[order(numero_de_accidentes_por_dia$Exp, decreasing = TRUE),]
```


Ahora mostraremos la distribucion de los valores con un braplot


```{r transformacion dia} 
barplot(numero_de_accidentes_por_dia$Exp, main="Number of accidents by day", 
        col=c('#09325E','#661F63','#BFBA38','#8A8E37','#C4BD79','#9FA8AB','#00490C'),
        names.arg =numero_de_accidentes_por_dia$DiaSn,
        xlab="Days of the week")
```









